# Log Generation Script

A PHP script for simulating the generation of log files for multiple applications. The script uses **Monolog** for logging and employs forking to simulate concurrent log generation.

## Table of Contents
1. [Overview](#overview)
2. [Requirements](#requirements)
3. [How It Works](#how-it-works)
4. [Key Functions](#key-functions)
5. [Installation](#installation)
6. [Usage](#usage)
7. [Example Log Output](#example-log-output)
8. [Configuration](#configuration)
9. [Dependencies](#dependencies)
10. [File Permissions](#file-permissions)

## Overview

This PHP script generates log files for different applications, simulating random log events with varying log levels. The logs are generated in real-time and written to the server's file system. The script uses **Monolog** for logging and handles process forking using PHP’s `pcntl_fork()` to simulate multiple applications generating logs concurrently.

## Requirements

1. **PHP** (version 7.4 or higher recommended)
2. **Composer** (for managing dependencies)
3. **Monolog** library (for logging)
4. **PCNTL Extension** (for process forking in PHP)

## How It Works

1. **Monolog Installation**:
   The script checks if **Monolog** is installed. If it's missing, it installs it using Composer.

2. **Forking for Log Generation**:
   The script creates multiple child processes using `pcntl_fork()` to simulate log generation for different applications concurrently.

3. **Log Levels**:
   Random log levels are chosen for each log message. The levels include:
   - DEBUG
   - INFO
   - NOTICE
   - WARNING
   - ERROR
   - CRITICAL
   - ALERT
   - EMERGENCY

4. **Log File Generation**:
   Log files are named based on the application name and the current date, e.g., `app01_2024-12-30.log`.

5. **Custom Log Formatter**:
   Monolog's `LineFormatter` is used to format logs with timestamps, log levels, and messages.

6. **Controlled Log Generation**:
   Logs are generated in a loop, with random sleep intervals between each log entry to simulate varying log generation speeds.

7. **Defunct Process Management**:
   After each child process finishes its task, the parent process collects the child to prevent defunct processes.

## Key Functions

### `executeCommand($command)`
Executes system commands using PHP’s `exec()` function.

- **Parameters**:
  - `$command`: The system command to execute.
  
- **Returns**:
  - An array with command output and the result code (0 for success).

### `getRandomLogLevel($logLevels)`
Generates a random log level from the predefined list of log levels.

- **Parameters**:
  - `$logLevels`: Array of log levels and their names.

- **Returns**:
  - A random log level (integer corresponding to one of the Monolog log levels).

### `generateLogs($logsPerFile, $intervalBetweenLogs, $aggressivenessFactor)`
Generates logs for each application using multiple child processes.

- **Parameters**:
  - `$logsPerFile`: Number of logs to generate per file.
  - `$intervalBetweenLogs`: Interval (in seconds) between log generations.
  - `$aggressivenessFactor`: Controls the aggressiveness of log generation.

- **Returns**:
  - None. The function runs continuously, generating log files until manually stopped.

## Installation

### Step 1: Clone the Repository
Clone this repository to your local machine using Git.

```bash
git clone https://github.com/yourusername/log-generation-script.git
cd log-generation-script
```

### Step 2: Install Dependencies
Run the following command to install Monolog and any other necessary dependencies using Composer.

```bash
composer install
```
If you don’t have Composer installed, you can get it from https://getcomposer.org/.

### composer.json
The *composer.json* file contains the required dependencies for this script. Below is an example of what the composer.json should look like:
```json
{
  "require": {
    "monolog/monolog": "^2.3"
  }
}
```
This file defines Monolog as a dependency. Composer will install the required version of Monolog when you run `composer install`.

## Usage
### Step 1: Run the Script
Once the dependencies are installed, you can run the script via the command line:
```bash
php generate_logs.php
```
The script will start generating log files. By default, it generates 50 log messages per file. You can change the number of logs generated by modifying the `generateLogs()` function or passing in different arguments.

### Step 2: Stop the Script
To stop the script, press `Ctrl + C` in the terminal.

## Example Log Output
Each log entry will be formatted like this:
```
[%datetime%] %channel% %level_name%: %message%
```

Sample log entries:
```log
[2024-12-30T11:41:18.391542+03:00] app02_2024-12-30.log INFO: This is a INFO message.
[2024-12-30T11:41:18.393136+03:00] app02_2024-12-30.log EMERGENCY: This is a EMERGENCY message.
[2024-12-30T11:41:18.396726+03:00] app02_2024-12-30.log DEBUG: This is a DEBUG message.
[2024-12-30T11:41:18.408733+03:00] app02_2024-12-30.log ERROR: This is a ERROR message.
[2024-12-30T11:41:18.409768+03:00] app02_2024-12-30.log ALERT: This is a ALERT message
```

## Configuration

- **Log Date Format:** Logs are formatted using `Y-m-d` (year-month-day).
- **Applications:** The script generates logs for (n applications) I've set it to 10 applications (from app01 to app00).
- **Log Generation Rate:** Logs are generated at random intervals between each entry.
- **Log File Naming:** Each log file is named using the format `appXX_YYYY-MM-DD.log`.

## Dependencies
1. **Monolog** Used for logging.

    - Install Monolog with `composer require monolog/monolog`.

2. **PCNTL** Required for process forking in PHP. Make sure the PCNTL extension is enabled in your PHP configuration.

## File Permissions
When running the script for the first time, you might encounter permission errors. To ensure the script has the appropriate permissions, follow these steps:
1. **Set Permissions for Script Execution** Make sure the script is executable. You can set the correct permissions using the following command:
```bash
chmod +x generate_logs.php
```
2. **Set Permissions for Log Directory** Ensure the logs directory is writable by the user running the script. Set the appropriate permissions for the directory:
```bash
chmod -R 755 logs
```
If you want to allow the script to write log files without permission issues, you can use:
```bash
chmod -R 777 logs
```
However, this might not be recommended in a production environment due to security risks. Make sure to adjust permissions based on your environment.

